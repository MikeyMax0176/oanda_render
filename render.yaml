databases:
  # Shared PostgreSQL database
  - name: oanda-bot-db
    databaseName: oanda_bot
    user: oanda_bot_user
    plan: starter

services:
  # --- Web (Streamlit dashboard - UI only) ---
  - type: web
    name: oanda-dashboard
    env: python
    plan: starter
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      streamlit run dashboard.py --server.address 0.0.0.0 --server.port ${PORT:-10000} --server.headless true
    envVars:
      - key: OANDA_HOST
        sync: false
      - key: OANDA_ACCOUNT
        sync: false
      - key: OANDA_TOKEN
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: oanda-bot-db
          property: connectionString
    autoDeploy: true

  # --- Worker (News sentiment + trading loop) ---
  - type: worker
    name: oanda-trading-worker
    env: python
    plan: starter
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      python -u worker.py
    envVars:
      - key: OANDA_HOST
        sync: false
      - key: OANDA_ACCOUNT
        sync: false
      - key: OANDA_TOKEN
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: oanda-bot-db
          property: connectionString
      - key: BOT_INSTRUMENT
        value: EUR_USD
      - key: BOT_TP_PIPS
        value: "38"
      - key: BOT_SL_PIPS
        value: "25"
      - key: BOT_RISK_USD
        value: "500"
      - key: BOT_TRADE_INTERVAL_MIN
        value: "1"
      - key: BOT_COOLDOWN_MIN
        value: "0"
      - key: BOT_MAX_CONCURRENT
        value: "3"
      - key: BOT_MIN_SPREAD
        value: "0.0002"
      - key: BOT_SENT_THRESHOLD
        value: "0.15"
    autoDeploy: true

