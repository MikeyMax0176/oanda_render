services:
  # --- Web (Streamlit dashboard) ---
  - type: web
    name: oanda-dashboard
    env: python
    plan: starter
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      bash start.sh
    envVars:
      - key: OANDA_HOST
        sync: false
      - key: OANDA_ACCOUNT
        sync: false
      - key: OANDA_TOKEN
        sync: false
      - key: OPENAI_API_KEY
        sync: false
    autoDeploy: true

  # --- Background Worker (News/Sentiment â†’ OANDA) ---
  - type: worker
    name: oanda-news-worker
    env: python
    plan: starter
    buildCommand: |
      pip install -r requirements.txt
    startCommand: |
      python -u bot.py
    envVars:
      - key: OANDA_HOST
        sync: false
      - key: OANDA_ACCOUNT
        sync: false
      - key: OANDA_TOKEN
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: DRY_RUN
        value: "true"
      - key: BOT_SENT_THRESHOLD
        value: "0.15"
      - key: BOT_MIN_SPREAD
        value: "0.0002"
      - key: BOT_MAX_CONCURRENT
        value: "3"
      - key: BOT_COOLDOWN_MIN
        value: "30"
      - key: BOT_TRADE_INTERVAL_MIN
        value: "3"
    autoDeploy: true
